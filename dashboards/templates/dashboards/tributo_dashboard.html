{% extends 'base.html' %}
{% load static %}

{% block header_title %}Panel del Tributo{% endblock %}

{% block extra_styles %}
    <link rel="stylesheet" href="{% static 'dashboards/css/dashboard_styles.css' %}">
{% endblock %}

{% block content %}
<div class="dashboard-wrapper">
    <!-- Header del Dashboard -->
    <div class="dashboard-header">
    </div>

    <!-- NavegaciÃ³n de Acciones RÃ¡pidas -->
    <nav class="dashboard-nav">
        <div class="dashboard-nav-right">
        </div>
    </nav>

    <!-- Contenedor principal del dashboard -->
    <div class="dashboard-container">
        <!-- EstadÃ­sticas principales -->
        <div class="stats-container">
        {% include 'dashboards/components/stats_card.html' with title="Mi Distrito" value=tributo_info.distrito icon="ğŸ›ï¸" %}
        {% include 'dashboards/components/stats_card.html' with title="Nivel" value=tributo_info.get_nivel_display icon="â­" %}
        {% include 'dashboards/components/stats_card.html' with title="Estado" value=tributo_info.get_estado_display icon="ğŸ¯" %}
        {% include 'dashboards/components/stats_card.html' with title="CÃ³digo" value=tributo_info.codigo_tributo icon="ğŸ”–" %}
        </div>

        <!-- Contenido principal del dashboard -->
        <div class="dashboard-content">
<div class="dashboard-row">
    <div class="dashboard-col-8">
        <div class="dashboard-card">
            <h3>ğŸ“‹ Mi InformaciÃ³n</h3>
            <div class="info-grid">
                <div class="info-item">
                    <span class="label">Nombre Completo:</span>
                    <span class="value">{{ user.get_full_name }}</span>
                </div>
                <div class="info-item">
                    <span class="label">Email:</span>
                    <span class="value">{{ user.email }}</span>
                </div>
                <div class="info-item">
                    <span class="label">Tipo:</span>
                    <span class="value">{{ tributo_info.get_tipo_display }}</span>
                </div>
                {% if tributo_info.unidad_academica %}
                <div class="info-item">
                    <span class="label">Unidad AcadÃ©mica:</span>
                    <span class="value">{{ tributo_info.unidad_academica }}</span>
                </div>
                {% endif %}
                {% if tributo_info.carrera %}
                <div class="info-item">
                    <span class="label">Carrera:</span>
                    <span class="value">{{ tributo_info.carrera }} - AÃ±o {{ tributo_info.aÃ±o_carrera }}</span>
                </div>
                {% endif %}
                <div class="info-item">
                    <span class="label">Lenguajes:</span>
                    <span class="value">{{ tributo_info.lenguajes_programacion|default:"No especificado" }}</span>
                </div>
            </div>
        </div>

        {% if ayudas_pendientes %}
        <div class="dashboard-card" style="border-left: 4px solid #FFD700; background: linear-gradient(to right, #fff8e1 0%, white 100%);">
            <h3>âœ¨ Nuevas Ayudas de tu Mentor</h3>
            <div style="margin-bottom: 15px;">
                <span style="background: #FFD700; color: #333; padding: 5px 15px; border-radius: 20px; font-weight: bold;">
                    {{ ayudas_pendientes.count }} sin leer
                </span>
            </div>
            {% for ayuda in ayudas_pendientes %}
            <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 3px solid #9B30FF;">
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                    <div style="font-weight: bold; color: #333;">{{ ayuda.get_tipo_display }}</div>
                    <div style="font-size: 0.85em; color: #999;">{{ ayuda.fecha_envio|date:"d/m H:i" }}</div>
                </div>
                <div style="color: #555; margin-bottom: 10px;">{{ ayuda.titulo }}</div>
                <a href="{% url 'dashboards:ver_ayudas' %}" style="background: #9B30FF; color: white; padding: 8px 15px; border-radius: 5px; text-decoration: none; display: inline-block; font-size: 0.9em;">
                    ğŸ“– Leer Ayuda
                </a>
            </div>
            {% endfor %}
            <a href="{% url 'dashboards:ver_ayudas' %}" style="color: #9B30FF; text-decoration: none; font-weight: bold; display: block; text-align: center; margin-top: 15px;">
                Ver todas las ayudas â†’
            </a>
        </div>
        {% endif %}

        <div class="dashboard-card">
            <h3>ğŸ® Mis Competencias</h3>
            <div class="empty-state">
                <p>AÃºn no has participado en ninguna competencia.</p>
                <p class="subtitle">Las competencias aparecerÃ¡n aquÃ­ cuando se abran las inscripciones.</p>
            </div>
        </div>
    </div>

    <div class="dashboard-col-4">
        {% include 'dashboards/components/quick_actions.html' with actions=tributo_actions %}
        
        {% if ayudas_recientes %}
        <div class="dashboard-card">
            <h3>ğŸ’¬ Ayudas Recientes</h3>
            {% for ayuda in ayudas_recientes %}
            <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin-bottom: 8px;">
                <div style="font-size: 0.85em; color: #666; margin-bottom: 3px;">{{ ayuda.get_tipo_display }}</div>
                <div style="font-weight: bold; color: #333; font-size: 0.9em;">{{ ayuda.titulo|truncatechars:40 }}</div>
                <div style="font-size: 0.8em; color: #999; margin-top: 5px;">âœ“ LeÃ­da {{ ayuda.fecha_lectura|timesince }} atrÃ¡s</div>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        
        <div class="dashboard-card">
            <h3>ğŸ† Mi Credencial</h3>
            <div class="credential-preview">
                {% if tributo_info.qr_code %}
                    <div class="qr-code">
                        <img src="{{ tributo_info.qr_code.url }}" alt="QR Code">
                    </div>
                    <p class="credential-code">{{ tributo_info.codigo_tributo }}</p>
                    {% if tributo_info.estado == 'acreditado' %}
                        <span class="badge badge-success">âœ“ Acreditado</span>
                    {% else %}
                        <span class="badge badge-warning">â³ Pendiente</span>
                    {% endif %}
                {% else %}
                    <p class="text-muted">Credencial en generaciÃ³n...</p>
                {% endif %}
            </div>
        </div>

        <div class="dashboard-card">
            <h3>ğŸ’¡ Consejos</h3>
            <ul class="tips-list">
                <li>MantÃ©n tu perfil actualizado</li>
                <li>Practica regularmente en la arena de entrenamiento</li>
                <li>Revisa los desafÃ­os disponibles</li>
                <li>Participa en las competencias para ganar experiencia</li>
            </ul>
        </div>
        </div>
    </div>
</div>
{% endblock %}
